<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    <meta charset="utf8"/>
    <meta name="viewport" content="initial-scale=1.0, width=device-width"/>
    <title>
      
        Mybatis | 芋圆明天不困
      
    </title>
    <meta name="description" content=""/>
    <meta name="keywords" content=""/>
    
      <link rel="apple-touch-icon"
            sizes="180x180"
            href="/images/apple-touch-icon.png"/>
    
    
      <link rel="icon"
            type="image/png"
            sizes="32x32"
            href="/images/favicon-32x32.png"/>
    
    
      <link rel="icon"
            type="image/png"
            sizes="16x16"
            href="/images/favicon-16x16.png"/>
    
    
      <link rel="mask-icon"
            href="/images/logo.svg"
            color=""/>
    
    
    
      
  <style>
    @font-face {
        font-family:sourceHanSerif;
        src: url(/font/regular.ttf);
        font-weight: regular;
    }
  </style>

  <style>
    @font-face {
        font-family:sourceHanSerif;
        src: url(/font/bold.ttf);
        font-weight: bold;
    }
  </style>


    
    <link rel="stylesheet"
          type="text/css"
          href='/css/layout.css'/>
    
    
  <link rel="stylesheet" type="text/css" href="/css/post.css" />
  

  <meta name="generator" content="Hexo 6.3.0"></head>
  <body>
    <div class="head">
      <div class="nav">
        <a href='/' class="nav-logo">
          <img alt="logo" height="60px" width="60px" src="/images/logo.svg"/>
        </a>
        <input id="navBtn" type="checkbox"/>
        <div class="nav-menu">
          
            
              <a class="nav-menu-item" href="/CS">技术</a>
            
              <a class="nav-menu-item" href="/Others">杂七杂八</a>
            
          
          
        </div>
        <label class="nav-btn" for="navBtn"></label>
      </div>
    </div>
    <div class="body">
      
  <article class="post-content">
    <div class="post-inner--toc">
      <div class="post-content__head">
        <div class="post-title">Mybatis</div>
        <div class="post-info">
          
  <a href="/tags/Java/" class="post-tag">#Java</a><a href="/tags/%E5%BC%80%E5%8F%91/" class="post-tag">#开发</a><a href="/tags/SSM/" class="post-tag">#SSM</a>


          <span class="post-date">2024-02-22</span>
        </div>
      </div>
      
        <aside class="toc-outer">
          <div class="toc-title">目录</div>
          <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#1-Mybatis%E7%AE%80%E4%BB%8B"><span class="post-toc-text">1.Mybatis简介</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8%EF%BC%88MyBatis3%EF%BC%89"><span class="post-toc-text">快速入门（MyBatis3）</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#2-Mybatis%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="post-toc-text">2.Mybatis基本使用</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E6%95%B0%E6%8D%AE%E8%BE%93%E5%85%A5"><span class="post-toc-text">数据输入</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E6%95%B0%E6%8D%AE%E8%BE%93%E5%87%BA"><span class="post-toc-text">数据输出</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#curd%E7%BB%83%E4%B9%A0"><span class="post-toc-text">curd练习</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Mapper-xml%E6%A0%87%E7%AD%BE%E6%80%BB%E7%BB%93"><span class="post-toc-text">Mapper.xml标签总结</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#3-Mybatis%E5%A4%9A%E8%A1%A8%E6%98%A0%E5%B0%84"><span class="post-toc-text">3.Mybatis多表映射</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2%E7%9A%84%E4%BC%98%E5%8C%96%E5%8F%8A%E6%80%BB%E7%BB%93"><span class="post-toc-text">多表查询的优化及总结</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#4-Mybatis%E5%8A%A8%E6%80%81%E8%AF%AD%E5%8F%A5"><span class="post-toc-text">4.Mybatis动态语句</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#if%E5%92%8Cwhere%E6%A0%87%E7%AD%BE"><span class="post-toc-text">if和where标签</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#set%E6%A0%87%E7%AD%BE%EF%BC%88update%EF%BC%89"><span class="post-toc-text">set标签（update）</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#trim%E6%A0%87%E7%AD%BE%EF%BC%88%E4%BA%86%E8%A7%A3%EF%BC%89"><span class="post-toc-text">trim标签（了解）</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#choose-when-otherwise%E6%A0%87%E7%AD%BE"><span class="post-toc-text">choose&#x2F;when&#x2F;otherwise标签</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#foreach%E6%A0%87%E7%AD%BE%EF%BC%88%E6%89%B9%E9%87%8F%E6%93%8D%E4%BD%9C%EF%BC%89"><span class="post-toc-text">foreach标签（批量操作）</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#sql%E7%89%87%E6%AE%B5"><span class="post-toc-text">sql片段</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#5-Mybatis%E9%AB%98%E7%BA%A7%E6%89%A9%E5%B1%95"><span class="post-toc-text">5.Mybatis高级扩展</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Mapper%E6%89%B9%E9%87%8F%E6%98%A0%E5%B0%84%E4%BC%98%E5%8C%96"><span class="post-toc-text">Mapper批量映射优化</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E6%8F%92%E4%BB%B6%E5%92%8C%E5%88%86%E9%A1%B5%E6%8F%92%E4%BB%B6PageHelper"><span class="post-toc-text">插件和分页插件PageHelper</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E5%92%8CMybatisX%E6%8F%92%E4%BB%B6"><span class="post-toc-text">逆向工程和MybatisX插件</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#ORM%E6%80%9D%E7%BB%B4"><span class="post-toc-text">ORM思维</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B"><span class="post-toc-text">逆向工程</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#6-%E6%80%BB%E7%BB%93"><span class="post-toc-text">6.总结</span></a></li></ol>
          <a href="#" class="toc-top">回到顶部</a>
        </aside>
      
      <div class="post-content__body">
        
          <div class="post-gallery">
            
          </div>
        
        <h1 id="1-Mybatis简介"><a href="#1-Mybatis简介" class="headerlink" title="1.Mybatis简介"></a>1.Mybatis简介</h1><p>MyBatis 是一款持久层框架，它支持自定义 SQL、存储过程以及高级映射。MyBatis 可以通过简单的 XML 或注解来配置和映射原始类型、接口和 Java <strong>POJO</strong>（Plain Old Java Objects，普通老式 Java 对象）为数据库中的记录。(<strong>推荐使用xml配置文件</strong>)</p>
<p>持久性框架对比：</p>
<ul>
<li>JDBC：sql语句夹杂在java代码耦合度高，代码长，开发效率低</li>
<li>Hibernate和JPA：封装程度高，自动生成sql语句，不容易特殊优化；反射操作多，数据库性能下降。</li>
<li>MyBatis：sql（专注数据）和java代码（专注业务）分开。</li>
</ul>
<p>开发效率：Hibernate&gt;Mybatis&gt;JDBC<br>运行效率：JDBC&gt;Mybatis&gt;Hibernate（越封装越慢）</p>
<h2 id="快速入门（MyBatis3）"><a href="#快速入门（MyBatis3）" class="headerlink" title="快速入门（MyBatis3）"></a>快速入门（MyBatis3）</h2><ul>
<li>原来的：xxxDao接口，规定方法；xxxDaoImpl实现类，数据库动作</li>
<li>mybatis：xxxMapper接口，规定方法；xxxMapper.xml 接口对应方法的sql语句</li>
</ul>
<p>xml文件放在resource里，不会被打包。</p>
<p><strong>步骤：导入依赖；准备实体类；创建xxxMapper接口，规定方法（增删改查）；写xxxMapper.xml，使用对应的标签写sql语句；mybatis的配置文件，规定连接的数据库和对应的xxxMapper.xml配置文件；使用mybatis api进行数据库查找（1.读取外部文件 2.创建SqlSessionFactory 3.获取SqlSession对象，自动开启jdbc 4.获取代理mapper对象，getMapper(接口.class) 5.管理资源或者提交事务）</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testSelectEmployee</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException &#123;<br><br>        <span class="hljs-comment">// 1.创建SqlSessionFactory对象</span><br>        <span class="hljs-comment">// ①声明Mybatis全局配置文件的路径</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">mybatisConfigFilePath</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;mybatis-config.xml&quot;</span>;<br><br>        <span class="hljs-comment">// ②以输入流的形式加载Mybatis配置文件</span><br>        <span class="hljs-type">InputStream</span> <span class="hljs-variable">inputStream</span> <span class="hljs-operator">=</span> Resources.getResourceAsStream(mybatisConfigFilePath);<br><br>        <span class="hljs-comment">// ③基于读取Mybatis配置文件的输入流创建SqlSessionFactory对象</span><br>        <span class="hljs-type">SqlSessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SqlSessionFactoryBuilder</span>().build(inputStream);<br><br>        <span class="hljs-comment">// 2.使用SqlSessionFactory对象开启一个会话（创建sqlSession）</span><br>        <span class="hljs-comment">//不会自动提交，需要SqlSession.commit()</span><br>        <span class="hljs-type">SqlSession</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();<br>        <span class="hljs-comment">//SqlSession session = sessionFactory.openSession(true);</span><br>        <span class="hljs-comment">//可以自动提交，不需要SqlSession.commit()</span><br><br>        <span class="hljs-comment">// 3.根据EmployeeMapper接口的Class对象获取Mapper接口类型的对象(动态代理技术)</span><br>        <span class="hljs-type">EmpMapper</span> <span class="hljs-variable">employeeMapper</span> <span class="hljs-operator">=</span> session.getMapper(EmpMapper.class);<br><br>        <span class="hljs-comment">// 4. 调用代理类方法既可以触发对应的SQL语句</span><br>        <span class="hljs-type">Employee</span> <span class="hljs-variable">employee</span> <span class="hljs-operator">=</span> employeeMapper.queryById(<span class="hljs-number">1</span>);<br>        System.out.println(<span class="hljs-string">&quot;employee = &quot;</span> + employee);<br><br>        <span class="hljs-comment">// 4.关闭SqlSession</span><br>        session.commit(); <span class="hljs-comment">//提交事务 [DQL不需要,其他需要]</span><br>        session.close(); <span class="hljs-comment">//关闭会话</span><br><br>    &#125;<br></code></pre></td></tr></table></figure>

<p>tips：可以将mapper文件创建为模版，可以直接新建<br>（settings，editor，file and code template）</p>
<ul>
<li>SqlSession：代表Java程序和数据库之间的会话。（HttpSession是Java程序和浏览器之间的会话）</li>
<li>SqlSessionFactory：是“生产”SqlSession的“工厂”。</li>
<li>工厂模式：如果创建某一个对象，使用的过程基本固定，那么我们就可以把创建这个对象的相关代码封装到一个“工厂类”中，以后都使用这个工厂类来“生产”我们需要的对象。</li>
</ul>
<p><img src="https://dzc2000919.oss-cn-shanghai.aliyuncs.com/zyx_images/202402272041201.png"></p>
<p>ibatis:不用写接口，直接创建mapper.xml文件内部编写sql语句</p>
<h1 id="2-Mybatis基本使用"><a href="#2-Mybatis基本使用" class="headerlink" title="2.Mybatis基本使用"></a>2.Mybatis基本使用</h1><p>mybatis配置文件：</p>
<center><img src="https://dzc2000919.oss-cn-shanghai.aliyuncs.com/zyx_images/202402291759867.png" width="70%" height="70%"></center>

<p>environments标签可以配置多个环境，但SqlSessionFactory只能应用一个环境（default）</p>
<ul>
<li><p>transactionManage事务管理器（两种，JDBC的提交和回滚功能，自动开启事务；managed，不提交回滚，不会自动开启事务）</p>
</li>
<li><p>datasource数据源，是否需要连接池（UNPOOLED，每次请求打开和关闭连接池，慢）</p>
</li>
<li><p>mybatis日志输出配置<br>settings（logImpl）：STOUT_LOGGING,控制台输出system.out（或者其他的日志系统slf4<br>j）</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">settings</span>&gt;</span><br>  <span class="hljs-comment">&lt;!-- SLF4J 选择slf4j输出！ --&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">setting</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;logImpl&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;SLF4J&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">settings</span>&gt;</span><br></code></pre></td></tr></table></figure></li>
<li><p>#{}：占位符+赋值，emp_id&#x3D;?,?&#x3D;赋值（？只能替代值的位置，不能替代容器名，标签，列名，sql关键字）</p>
</li>
<li><p>${}：字符串拼接，”emp_id&#x3D;”+id（动态的标签，列名，sql关键字，使用$）</p>
</li>
</ul>
<p><strong>推荐使用#{key},防止注入攻击的问题</strong></p>
<h2 id="数据输入"><a href="#数据输入" class="headerlink" title="数据输入"></a>数据输入</h2><p><img src="https://dzc2000919.oss-cn-shanghai.aliyuncs.com/zyx_images/202402291820030.png"></p>
<p>这里数据输入具体是指上层方法（例如Service方法）调用Mapper接口时，数据传入的形式。</p>
<ul>
<li><p>简单类型：只包含一个值的数据类型</p>
<ul>
<li>基本数据类型：int、byte、short、double、……</li>
<li>基本数据类型的包装类型：Integer、Character、Double、……</li>
<li>字符串类型：String</li>
</ul>
</li>
<li><p>复杂类型：包含多个值的数据类型</p>
<ul>
<li>实体类类型：Employee、Department、……</li>
<li>集合类型：List、Set、Map、……</li>
<li>数组类型：int[]、String[]、……</li>
<li>复合类型：List<Employee>、实体类中包含集合……</li>
</ul>
</li>
<li><p><strong>单个简单类型参数</strong>：使用#{}中可以随意命名，通常还是使用和接口方法参数同名。</p>
</li>
<li><p><strong>实体类类型</strong>：<br>Mapper接口中抽象方法的声明</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-type">int</span> <span class="hljs-title function_">insertEmployee</span><span class="hljs-params">(Employee employee)</span>;<br></code></pre></td></tr></table></figure>
<p>SQL语句</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs XML"><span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;insertEmployee&quot;</span>&gt;</span><br>  insert into t_emp(emp_name,emp_salary) values(#&#123;empName&#125;,#&#123;empSalary&#125;)<br><span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span><br></code></pre></td></tr></table></figure>
<p>结论：Mybatis会根据#{}中传入的数据，加工成getXxx()方法，通过反射在实体类对象中调用这个方法，从而获取到对应的数据。填充到#{}解析后的问号占位符这个位置。</p>
</li>
<li><p><strong>多个简单类型对象</strong><br>不能用函数的形参名字取值<br>法1:<strong>注解指定</strong><br><img src="https://dzc2000919.oss-cn-shanghai.aliyuncs.com/zyx_images/202402291830961.png"><br>法2:<strong>mybatis默认机制</strong></p>
</li>
</ul>
<p>#{arg0},#{arg1}<br>#{param1},#{param2}</p>
<ul>
<li><strong>Map类型参数</strong><br>mapper接口不能重载！！！！<br>key即为传入的map对象的key</li>
</ul>
<h2 id="数据输出"><a href="#数据输出" class="headerlink" title="数据输出"></a>数据输出</h2><p>数据输出总体上有两种形式：</p>
<ul>
<li>增删改操作返回的受影响行数，直接使用 int 或 long 类型接收</li>
<li><strong>查询操作的查询结果</strong>，指定查询的输出数据类型</li>
<li>插入场景下，实现主键数据回显示</li>
</ul>
<ol>
<li>单个简单类型</li>
</ol>
<ul>
<li>select标签，通过resultType指定查询返回值类型！<br>resultType &#x3D; “全限定符 ｜ 别名 ｜ 如果是返回集合类型，写范型类型即可”<br>（Mybatis 内部给常用的数据类型设定了很多别名，在mybatis官网中，typeAliases中查看，包装数据类型大写变小写Integer int；基本数据类型加下划线 _int；集合容器类型，Map map）</li>
<li>如果没有提供别名，需要自己定义或者类的全限定符</li>
</ul>
<ol start="2">
<li>返回实体类对象<br><img src="https://dzc2000919.oss-cn-shanghai.aliyuncs.com/zyx_images/202402291934040.png"></li>
</ol>
<p>数据库中使用蛇形命名；java中使用驼峰式命名（可以设置，支持驼峰式自动映射）</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- 在全局范围内对Mybatis进行配置 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">settings</span>&gt;</span><br>  <span class="hljs-comment">&lt;!-- 将mapUnderscoreToCamelCase属性配置为true，表示开启自动映射驼峰式命名规则 --&gt;</span><br>  <span class="hljs-comment">&lt;!-- 规则要求数据库表字段命名方式：单词_单词 --&gt;</span><br>  <span class="hljs-comment">&lt;!-- 规则要求Java实体类属性名命名方式：首字母小写的驼峰式命名 --&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">setting</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;mapUnderscoreToCamelCase&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;true&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">settings</span>&gt;</span><br></code></pre></td></tr></table></figure>
<p>即直接可以select * ……（不用进行命名的映射）</p>
<ol start="3">
<li><p>返回Map类型<br>适用于SQL查询返回的各个字段综合起来，没有一个现有的实体类对应，不能封装到实体类对象中，能够封装成实体类类型的，就不使用Map类型。<br>列名位key，值为value</p>
</li>
<li><p>返回list类型<br>查询结果返回多个实体类对象，多个实体类对象放在List集合中返回。在resultType属性中还是设置实体类类型即可（不需要指定集合类型，只需要指定泛型）</p>
</li>
<li><p>获取插入数据的主键</p>
</li>
</ol>
<ul>
<li>自增长类型主键<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- int insertEmployee(Employee employee); --&gt;</span><br><span class="hljs-comment">&lt;!-- useGeneratedKeys:使用自动生成的主键值 --&gt;</span><br><span class="hljs-comment">&lt;!-- keyProperty(实体类对象的属性)：指定接收主键列的属性名，mybatis将生成的主键值赋值给属性--&gt;</span><br><span class="hljs-comment">&lt;!-- keyColumn（数据库中列的值）:主键列的值--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;insertEmployee&quot;</span> <span class="hljs-attr">useGeneratedKeys</span>=<span class="hljs-string">&quot;true&quot;</span> <span class="hljs-attr">keyProperty</span>=<span class="hljs-string">&quot;empId&quot;</span> <span class="hljs-attr">keyColumn</span>=<span class="hljs-string">&quot;emp_id&quot;</span>&gt;</span><br>  insert into t_emp(emp_name,emp_salary)<br>  values(#&#123;empName&#125;,#&#123;empSalary&#125;)<br><span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span><br></code></pre></td></tr></table></figure>
<strong>Mybatis是将自增主键的值设置到实体类对象中，而不是以Mapper接口方法返回值的形式返回。</strong></li>
<li>非自增长类型主键<br>对于不支持自增型主键的数据库（例如 Oracle）或者字符串类型主键，则可以使用 selectKey 子元素：selectKey 元素将会首先运行，先生成主键值id，然后插入语句会被调用！<br>使用uuid作为主键，根据时间戳等信息生成：SELECT UUID()(或者自己维护uuid，进行赋值)<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;insertUser&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;User&quot;</span>&gt;</span><br><span class="hljs-comment">&lt;!-- order,sql语句是在插入语句之前还是之后；resultType指定uuid的数据类型是String--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">selectKey</span> <span class="hljs-attr">order</span>=<span class="hljs-string">&quot;BEFORE&quot;</span> <span class="hljs-attr">keyProperty</span>=<span class="hljs-string">&quot;id&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;java.lang.String&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">order</span>=<span class="hljs-string">&quot;BEFORE&quot;</span>&gt;</span><br>        SELECT UUID() as id<br>        <span class="hljs-comment">&lt;!-- SELECT REPLACE(UUID(),&#x27;-&#x27;,&#x27;&#x27;) --&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">selectKey</span>&gt;</span><br>    INSERT INTO user (id, username, password) <br>    VALUES (<br>        #&#123;id&#125;,<br>        #&#123;username&#125;,<br>        #&#123;password&#125;<br>    )<br><span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span><br></code></pre></td></tr></table></figure></li>
</ul>
<ol start="6">
<li>实体类类型和数据库字段对应关系<br>列名和属性不一致如何解决：</li>
</ol>
<ul>
<li>取别名 select emp_id empId,emp_name empName,emp_salary empSalary from t_emp where emp_id&#x3D;#{maomi}</li>
<li>全局配置自动识别驼峰式命名规则<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- 使用settings对Mybatis全局进行设置 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">settings</span>&gt;</span><br>  <span class="hljs-comment">&lt;!-- 将xxx_xxx这样的列名自动映射到xxXxx这样驼峰式命名的属性名 --&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">setting</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;mapUnderscoreToCamelCase&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;true&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">settings</span>&gt;</span><br></code></pre></td></tr></table></figure></li>
<li>使用resultMap(自定义映射)<br>resultType：按照规则自动映射（是否开启驼峰映射），对象嵌套或者<strong>深层次的对象结构无法映射（多表查询）</strong>，resultMap可以！！！</li>
</ul>
<p>声明resultMap标签,自定义column到property之间的对应关系：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- id标识，type为返回值类型--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;selectEmployeeByRMResultMap&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;com.atguigu.mybatis.entity.Employee&quot;</span>&gt;</span><br>  <span class="hljs-comment">&lt;!-- id标签:设置主键列和主键属性之间的对应关系 --&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;emp_id&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;empId&quot;</span>/&gt;</span><br> <span class="hljs-comment">&lt;!-- result标签:设置普通字段和Java实体类属性之间的关系 --&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;emp_name&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;empName&quot;</span>/&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;emp_salary&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;empSalary&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span><br><br><span class="hljs-comment">&lt;!-- Employee selectEmployeeByRM(Integer empId); --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;selectEmployeeByRM&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;selectEmployeeByRMResultMap&quot;</span>&gt;</span><br>  select emp_id,emp_name,emp_salary from t_emp where emp_id=#&#123;empId&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h2 id="curd练习"><a href="#curd练习" class="headerlink" title="curd练习"></a>curd练习</h2><p>导入lombok插件（maven search中找），可以自动添加get set方法。</p>
<p>传入的是实体类只需要写属性名即可 value(#{},#{})</p>
<p>junit测试注意：<br>可以加入成员变量，使用beforeEach，将重复的执行的代码放在该方法中。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> SqlSession session;<br>   <span class="hljs-comment">// junit会在每一个@Test方法前执行@BeforeEach方法</span><br>   <span class="hljs-meta">@BeforeEach</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>       session = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SqlSessionFactoryBuilder</span>()<br>               .build(<br>                       Resources.getResourceAsStream(<span class="hljs-string">&quot;mybatis-config.xml&quot;</span>))<br>               .openSession();<br>   &#125;<br>    <span class="hljs-comment">// junit会在每一个@Test方法后执行@@AfterEach方法</span><br>   <span class="hljs-meta">@AfterEach</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">clear</span><span class="hljs-params">()</span> &#123;<br>       session.commit();<br>       session.close();<br>   &#125;<br></code></pre></td></tr></table></figure>

<h2 id="Mapper-xml标签总结"><a href="#Mapper-xml标签总结" class="headerlink" title="Mapper.xml标签总结"></a>Mapper.xml标签总结</h2><p>语句映射，映射器的 XML 文件就显得相对简单。<br>insert涉及主键回显。</p>
<h1 id="3-Mybatis多表映射"><a href="#3-Mybatis多表映射" class="headerlink" title="3.Mybatis多表映射"></a>3.Mybatis多表映射</h1><p>重点：</p>
<ul>
<li>多表查询语句使用（连接查询）</li>
<li>实体类设计（承接多个表的查询结果）</li>
<li>使用<strong>ResultMap</strong>完成多表结果映射</li>
</ul>
<p>多表关系：1对1；1对多，多对1；多对多<br>但实体类设计关系（查询）：单向查看</p>
<ul>
<li>对1：包括对方对象的属性</li>
<li>对多：包括对方类型集合</li>
</ul>
<p>发生多表查询时，才需要设计和修改实体类，否则不修改<br>无论多少张表联查，实体类设计都是两两考虑<br>在查询映射的时候，只需要关注本次查询相关的属性例如：查询订单和对应的客户，不需要关注客户中的订单集合。</p>
<p>内连接：结果集中不包括一个表和另一个表不匹配的行<br>左外连接：左右表匹配+左表匹配的数据<br>右外连接：左右表匹配+右表匹配的数据<br>满外连接：由于mysql不支持FULL JOIN，于是我们需要用 LEFT JOIN UNION RIGHT join代替。</p>
<p>配置resultMap的映射关系：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- 配置resultMap实现从Customer到OrderList的“对多”关联关系 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;selectCustomerWithOrderListResultMap&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;customer&quot;</span>&gt;</span><br>  <span class="hljs-comment">&lt;!-- 映射Customer本身的属性 --&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;customer_id&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;customerId&quot;</span>/&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;customer_name&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;customerName&quot;</span>/&gt;</span><br>  <span class="hljs-comment">&lt;!-- association对单一的对象属性赋值，javaType --&gt;</span><br>  <span class="hljs-comment">&lt;!-- collection标签：给集合属性赋值 --&gt;</span><br>  <span class="hljs-comment">&lt;!-- property属性：在Customer类中，集合（对多）的属性名 --&gt;</span><br>  <span class="hljs-comment">&lt;!-- ofType属性：集合属性中元素的类型，泛型 --&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">collection</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;orderList&quot;</span> <span class="hljs-attr">ofType</span>=<span class="hljs-string">&quot;order&quot;</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- 映射Order的属性 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;order_id&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;orderId&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;order_name&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;orderName&quot;</span>/&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">collection</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h2 id="多表查询的优化及总结"><a href="#多表查询的优化及总结" class="headerlink" title="多表查询的优化及总结"></a>多表查询的优化及总结</h2><table>
<thead>
<tr>
<th>setting属性</th>
<th>属性含义</th>
<th>可选值</th>
<th>默认值</th>
</tr>
</thead>
<tbody><tr>
<td>autoMappingBehavior</td>
<td>指定 MyBatis 应如何自动映射列到字段或属性。 NONE 表示关闭自动映射；PARTIAL 只会自动映射没有定义嵌套结果映射的字段。 FULL 会自动映射任何复杂的结果集（无论是否嵌套）。</td>
<td>NONE, PARTIAL, FULL</td>
<td>PARTIAL</td>
</tr>
<tr>
<td>则可以省略result标签的映射（省略属性和列的映射）</td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h1 id="4-Mybatis动态语句"><a href="#4-Mybatis动态语句" class="headerlink" title="4.Mybatis动态语句"></a>4.Mybatis动态语句</h1><p>条件不取值，是动态变化的，需要Mybatis动态语句</p>
<h2 id="if和where标签"><a href="#if和where标签" class="headerlink" title="if和where标签"></a>if和where标签</h2><p>where和if必须嵌套使用</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- List&lt;Employee&gt; selectEmployeeByCondition(Employee employee); --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;selectEmployeeByCondition&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;employee&quot;</span>&gt;</span><br>    select emp_id,emp_name,emp_salary from t_emp<br>    <span class="hljs-comment">&lt;!-- </span><br><span class="hljs-comment">    1.自动添加where关键字</span><br><span class="hljs-comment">    2.自动去掉“标签体内前面多余的and/or” --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">where</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- if标签判断的结果是否为true，则加入sql语句 --&gt;</span><br>        <span class="hljs-comment">&lt;!-- 在if标签的test属性中，可以访问实体类的属性，不可以访问数据库表的字段 --&gt;</span><br>        <span class="hljs-comment">&lt;!-- 大于等于&amp;gt;  小于等于&amp;lt --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;empName != null&quot;</span>&gt;</span><br>            <span class="hljs-comment">&lt;!-- 在if标签内部，需要访问接口的参数时还是正常写#&#123;&#125; --&gt;</span><br>            or emp_name=#&#123;empName&#125;<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;empSalary <span class="hljs-symbol">&amp;gt;</span> 2000&quot;</span>&gt;</span><br>            or emp_salary&gt;#&#123;empSalary&#125;<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">where</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></td></tr></table></figure>
<h2 id="set标签（update）"><a href="#set标签（update）" class="headerlink" title="set标签（update）"></a>set标签（update）</h2><p>并且动态去掉两端多余的逗号,自动添加set关键字</p>
<h2 id="trim标签（了解）"><a href="#trim标签（了解）" class="headerlink" title="trim标签（了解）"></a>trim标签（了解）</h2><p>trim能同时替代where和set，可以指定要添加的前&#x2F;后缀，或者要去掉的前后缀；多个值用｜分隔</p>
<h2 id="choose-when-otherwise标签"><a href="#choose-when-otherwise标签" class="headerlink" title="choose&#x2F;when&#x2F;otherwise标签"></a>choose&#x2F;when&#x2F;otherwise标签</h2><p>相当于sql语句的if-else。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- List&lt;Employee&gt; selectEmployeeByConditionByChoose(Employee employee) --&gt;</span><br><span class="hljs-comment">&lt;!-- 从上向下依次判断，满足则直接进入这个分支 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;selectEmployeeByConditionByChoose&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;com.atguigu.mybatis.entity.Employee&quot;</span>&gt;</span><br>    select emp_id,emp_name,emp_salary from t_emp<br>    where<br>    <span class="hljs-tag">&lt;<span class="hljs-name">choose</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">when</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;empName != null&quot;</span>&gt;</span>emp_name=#&#123;empName&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">when</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">when</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;empSalary <span class="hljs-symbol">&amp;lt;</span> 3000&quot;</span>&gt;</span>emp_salary <span class="hljs-symbol">&amp;lt;</span> 3000<span class="hljs-tag">&lt;/<span class="hljs-name">when</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">otherwise</span>&gt;</span>1=1<span class="hljs-tag">&lt;/<span class="hljs-name">otherwise</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">choose</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></td></tr></table></figure>
<h2 id="foreach标签（批量操作）"><a href="#foreach标签（批量操作）" class="headerlink" title="foreach标签（批量操作）"></a><strong>foreach标签（批量操作）</strong></h2><p>批量更新的时候，需要注意：<br>实现批量更新则需要多条SQL语句拼起来，用分号分开。一次性发送多条SQL语句让数据库执行，需要在数据库连接信息的URL地址中设置（涉及多个语句）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs .properties">atguigu.dev.url=jdbc:mysql:///mybatis-example?allowMultiQueries=true<br></code></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- int updateEmployeeBatch(@Param(&quot;empList&quot;) List&lt;Employee&gt; empList) --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">update</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;updateEmployeeBatch&quot;</span>&gt;</span><br><span class="hljs-comment">&lt;!-- values (xxx,1),(xxx,2) 没有前缀和后缀，不用加 --&gt;</span><br><span class="hljs-comment">&lt;!--整个sql语句遍历 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">foreach</span> <span class="hljs-attr">collection</span>=<span class="hljs-string">&quot;empList&quot;</span>  <span class="hljs-attr">item</span>=<span class="hljs-string">&quot;emp&quot;</span> <span class="hljs-attr">separator</span>=<span class="hljs-string">&quot;,&quot;</span> &gt;</span><br>        update t_emp set emp_name=#&#123;emp.empName&#125; where emp_id=#&#123;emp.empId&#125;<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">foreach</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">update</span>&gt;</span><br><br><span class="hljs-comment">&lt;!-- 找可以遍历的地方 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">delete</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;deleteBatch&quot;</span>&gt;</span><br><span class="hljs-comment">&lt;!--in (1,2,3) --&gt;</span><br>delete from t_emp where id in <br><span class="hljs-tag">&lt;<span class="hljs-name">foreach</span> <span class="hljs-attr">collection</span>=<span class="hljs-string">&quot;ids&quot;</span> <span class="hljs-attr">open</span>=<span class="hljs-string">&quot;(&quot;</span> <span class="hljs-attr">separator</span>=<span class="hljs-string">&quot;,&quot;</span> <span class="hljs-attr">close</span>=<span class="hljs-string">&quot;)&quot;</span> <span class="hljs-attr">item</span>=<span class="hljs-string">&quot;id&quot;</span>&gt;</span><br>#&#123;id&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">foreach</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">delete</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;insertBatch&quot;</span>&gt;</span><br>insert into tmp (emp_nama,emp_salary) values<br><span class="hljs-tag">&lt;<span class="hljs-name">foreach</span> <span class="hljs-attr">collection</span>=<span class="hljs-string">&quot;list&quot;</span> <span class="hljs-attr">separator</span>=<span class="hljs-string">&quot;,&quot;</span> <span class="hljs-attr">item</span>=<span class="hljs-string">&quot;employee&quot;</span>&gt;</span><br>(#&#123;employee.empName&#125;,#&#123;employee.empSalary&#125;)<br><span class="hljs-tag">&lt;/<span class="hljs-name">foreach</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span><br></code></pre></td></tr></table></figure>
<h2 id="sql片段"><a href="#sql片段" class="headerlink" title="sql片段"></a>sql片段</h2><p>避免每次都写重复的sql语句<br><img src="https://dzc2000919.oss-cn-shanghai.aliyuncs.com/zyx_images/202403021437954.png"></p>
<h1 id="5-Mybatis高级扩展"><a href="#5-Mybatis高级扩展" class="headerlink" title="5.Mybatis高级扩展"></a>5.Mybatis高级扩展</h1><h2 id="Mapper批量映射优化"><a href="#Mapper批量映射优化" class="headerlink" title="Mapper批量映射优化"></a>Mapper批量映射优化</h2><p>对于resource目录下的内容：</p>
<ul>
<li><strong>打包后会直接放入类路径</strong></li>
<li>直接创建多层文件夹，使用&#x2F;分隔，如果使用点.表示单层文件</li>
</ul>
<p>法1:可以将mapper.xml文件放在mapper接口所在的包，但需要增加配置文件<br>法2:可以在sources下创建mapper接口包一致的文件夹结构存放mapperxml文件<br>(要求xml文件和mapper接口的命名必须相同)<br><img src="https://dzc2000919.oss-cn-shanghai.aliyuncs.com/zyx_images/202403021455354.png"></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">mappers</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">package</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;com.atguigu.mapper&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">mappers</span>&gt;</span><br></code></pre></td></tr></table></figure>
<h2 id="插件和分页插件PageHelper"><a href="#插件和分页插件PageHelper" class="headerlink" title="插件和分页插件PageHelper"></a>插件和<strong>分页插件PageHelper</strong></h2><p>插件（拦截器）：在sql语句执行之前，进行后置修改<br>插件可以在用于语句执行过程中进行拦截，并允许通过自定义处理程序来<strong>拦截</strong>和<strong>修改 SQL 语句</strong>、<strong>映射语句的结果</strong>……<br>mybatis插件机制包括以下几个部分：</p>
<ol>
<li><code>Intercepter（拦截器）</code></li>
<li><code>Invocation（调用）</code></li>
<li><code>InterceptorChain（拦截器链）</code></li>
</ol>
<ul>
<li>分页插件PageHelper<br>对于sql语句需要写limit x，y<br>x表示偏移量（page-1）*pageSize，y查询数量pageSize<br>使用该插件的作用，不用添加limit和分号结尾，经过PageHelper插件会自动计算page和pageSize，会后置加limit，然后执行sql语句</li>
</ul>
<ol>
<li>pom.xml引入依赖<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.github.pagehelper<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>pagehelper<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.1.11<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure></li>
<li>在mybatis-config.xml配置分页插件<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- value数据库的类型 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span> <span class="hljs-attr">interceptor</span>=<span class="hljs-string">&quot;com.github.pagehelper.PageInterceptor&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;helperDialect&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;mysql&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br></code></pre></td></tr></table></figure></li>
<li>test<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testTeacherRelationshipToMulti</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">TeacherMapper</span> <span class="hljs-variable">teacherMapper</span> <span class="hljs-operator">=</span> session.getMapper(TeacherMapper.class);<br>    <span class="hljs-comment">//当前第几页，每页显示几个</span><br>    <span class="hljs-comment">//<span class="hljs-doctag">TODO:</span>startPage和PageInfo之间只能装一个sql语句的查询结果。</span><br>    PageHelper.startPage(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>);<br>    <span class="hljs-comment">// 查询Customer对象同时将关联的Order集合查询出来</span><br>    List&lt;Teacher&gt; allTeachers = teacherMapper.findAllTeachers();<br>    <span class="hljs-comment">//将查询的数据封装到PageInfo的分页实体类中（共多少页，多少条）</span><br>    PageInfo&lt;Teacher&gt; pageInfo = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PageInfo</span>&lt;&gt;(allTeachers);<br><br>    System.out.println(<span class="hljs-string">&quot;pageInfo = &quot;</span> + pageInfo);<br>    <span class="hljs-type">long</span> <span class="hljs-variable">total</span> <span class="hljs-operator">=</span> pageInfo.getTotal(); <span class="hljs-comment">// 获取总记录数</span><br>    System.out.println(<span class="hljs-string">&quot;total = &quot;</span> + total);<br>    <span class="hljs-type">int</span> <span class="hljs-variable">pages</span> <span class="hljs-operator">=</span> pageInfo.getPages();  <span class="hljs-comment">// 获取总页数</span><br>    System.out.println(<span class="hljs-string">&quot;pages = &quot;</span> + pages);<br>    <span class="hljs-type">int</span> <span class="hljs-variable">pageNum</span> <span class="hljs-operator">=</span> pageInfo.getPageNum(); <span class="hljs-comment">// 获取当前页码</span><br>    System.out.println(<span class="hljs-string">&quot;pageNum = &quot;</span> + pageNum);<br>    <span class="hljs-type">int</span> <span class="hljs-variable">pageSize</span> <span class="hljs-operator">=</span> pageInfo.getPageSize(); <span class="hljs-comment">// 获取每页显示记录数</span><br>    System.out.println(<span class="hljs-string">&quot;pageSize = &quot;</span> + pageSize);<br>    List&lt;Teacher&gt; teachers = pageInfo.getList(); <span class="hljs-comment">//获取查询页的数据集合</span><br>    System.out.println(<span class="hljs-string">&quot;teachers = &quot;</span> + teachers);<br>    teachers.forEach(System.out::println);<br><br>&#125;<br></code></pre></td></tr></table></figure></li>
</ol>
<h2 id="逆向工程和MybatisX插件"><a href="#逆向工程和MybatisX插件" class="headerlink" title="逆向工程和MybatisX插件"></a>逆向工程和MybatisX插件</h2><h3 id="ORM思维"><a href="#ORM思维" class="headerlink" title="ORM思维"></a>ORM思维</h3><p><strong>ORM</strong>（Object-Relational Mapping，<strong>对象-关系映射</strong>）是一种将数据库和面向对象编程语言中的对象之间进行转换的技术。<strong>将对象和关系数据库的概念进行映射</strong>，最后可以通过<strong>方法调用</strong>进行数据库操作。<br>sql语句，面向过程的编程思维<br>方法，面向对象的编程思维<br>jdbc，相当于将sql语句放在java代码<br><strong>使用面向对象思维进行数据库操作，应用在持久性框架</strong><br>mybatis：半自动ORM思维持久层框架（提供curd方法，不提供sql语句，自己写）<br>hibernate：全自动ORM思维持久层框架。（提供，自动生成）</p>
<h3 id="逆向工程"><a href="#逆向工程" class="headerlink" title="逆向工程"></a>逆向工程</h3><p>MyBatis 的逆向工程是一种自动化生成持久层代码和映射文件的工具，它可以根据数据库表结构和设置的参数生成对应的实体类、Mapper.xml 文件、Mapper 接口等代码文件，</p>
<ul>
<li>期望半自动的orm框架，也能实现单表的curd自动生成。</li>
<li>半自动-&gt;全自动发展的过程</li>
<li><strong>逆向工程只能生成单表crud的操作，多表查询依然需要我们自己编写</strong></li>
<li>MyBatis 的逆向工程有两种方式：<strong>MyBatis Generator 插件</strong>实现和 <strong>Maven 插件</strong>实现。</li>
<li><strong>MyBatisX 是一个 MyBatis 的代码生成插件</strong></li>
</ul>
<p><img src="https://dzc2000919.oss-cn-shanghai.aliyuncs.com/zyx_images/202403021623706.png"></p>
<h1 id="6-总结"><a href="#6-总结" class="headerlink" title="6.总结"></a>6.总结</h1>
      </div>
    </div>
  </article>
  <div class="post__foot">
    
    <div class="post-nav">
  
    <div class="post-nav-item-left"></div>
  
  <div class="vhr"></div>
  
    <a class="post-nav-item-right" href="/2024/01/20/Spring%E6%A1%86%E6%9E%B6/">
      <div class="text-align">
        <span class="text-small">下一篇</span>
        <svg t="1670570876164"
             class="icon"
             viewBox="0 0 1024 1024"
             transform="scale(-1,-1)"
             width="16"
             height="16">
          <path d="M384 512L731.733333 202.666667c17.066667-14.933333 19.2-42.666667 4.266667-59.733334-14.933333-17.066667-42.666667-19.2-59.733333-4.266666l-384 341.333333c-10.666667 8.533333-14.933333 19.2-14.933334 32s4.266667 23.466667 14.933334 32l384 341.333333c8.533333 6.4 19.2 10.666667 27.733333 10.666667 12.8 0 23.466667-4.266667 32-14.933333 14.933333-17.066667 14.933333-44.8-4.266667-59.733334L384 512z" p-id="14596"/>
        </svg>
      </div>
      Spring框架
    </a>
  
</div>

    
      <div class="related-post">
  <div class="related__head">
  <a href="/tags/Java/" class="post-tag">#Java</a><a href="/tags/%E5%BC%80%E5%8F%91/" class="post-tag">#开发</a><a href="/tags/SSM/" class="post-tag">#SSM</a>

</div>
  <div class="realated__body">
    
      DEBUG: 请安装插件 <a target="_blank" rel="noopener" href="https://github.com/tea3/hexo-related-popular-posts">hexo-related-popular-posts</a> 或关闭 related_post 配置!
    
  </div>
</div>

    
    
  </div>

    </div>
    <div class="foot">
      <div class="foot-inner">
        <div class="foot__head">
          
            <div class="foot-line">
              
                <div class="matts">若</div>
              
                <div class="matts">无</div>
              
                <div class="matts">闲</div>
              
                <div class="matts">事</div>
              
                <div class="matts">挂</div>
              
                <div class="matts">心</div>
              
                <div class="matts">头</div>
              
            </div>
          
            <div class="foot-line">
              
                <div class="matts">便</div>
              
                <div class="matts">是</div>
              
                <div class="matts">人</div>
              
                <div class="matts">间</div>
              
                <div class="matts">好</div>
              
                <div class="matts">时</div>
              
                <div class="matts">节</div>
              
            </div>
          
        </div>
        <div class="foot__body">
          
            <div class="foot-item">
              <div class="foot-item__head">朋友</div>
              <div class="foot-item__body">
                
                  <div class="text">
                    <img alt="link" height="20px" width="20px" src="/images/icon/icon-link.svg"/>
                    <a class="foot-link" target="_blank" rel="noopener" href="https://carriemint.github.io">芋圆的主页</a>
                  </div>
                
                <div class="text">
                  <img alt="link" height="20px" width="20px" src="/images/icon/icon-link+.svg"/>
                  <a class="foot-link"
                     href="mailto:863162796@qq.com?subject=%E7%94%B3%E8%AF%B7%20Hozen.site%20%E7%9A%84%E5%8F%8B%E9%93%BE%E4%BD%8D%E7%BD%AE">
                  申请友链</a>
                </div>
              </div>
            </div>
          
          
            <div class="foot-item">
              <div class="foot-item__head">账号</div>
              <div class="foot-item__body">
                
                  <div class="text">
                    <img alt="link" height="20px" width="20px" src="/images/logo-github.svg"/>
                    <a class="foot-link" target="_blank" rel="noopener" href="https://github.com/carriemint">carriemint</a>
                  </div>
                
              </div>
            </div>
          
          <div class="foot-item">
            <div class="foot-item__head">联系</div>
            <div class="foot-item__body">
              <div class="text">
                <img alt="link" height="20px" width="20px" src="/images/icon/icon-email.svg"/>
                <a class="foot-link" href="mailto:863162796@qq.com">863162796@qq.com</a>
              </div>
            </div>
          </div>
        </div>
        <div class="copyright">
          <a href="http://example.com">芋圆明天不困</a> &nbsp;|&nbsp;由&nbsp;<a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>&nbsp;及&nbsp;
          <svg width="20" height="20" viewBox="0 0 725 725">
            <path fill-rule="evenodd" fill="rgb(221, 221, 221)" d="M145.870,236.632 L396.955,103.578 L431.292,419.44 L156.600,522.53 L145.870,236.632 Z"/>
            <path fill-rule="evenodd" fill="rgb(159, 159, 159)" d="M396.955,103.578 L564.345,234.486 L611.558,513.469 L431.292,419.44 L396.955,103.578 Z"/>
            <path fill-rule="evenodd" fill="rgb(0, 0, 0)" d="M431.292,419.44 L611.558,513.469 L358.327,595.18 L156.600,522.53 L431.292,419.44 Z"/>
          </svg>
          <a target="_blank" rel="noopener" href="https://github.com/hooozen/hexo-theme-tranquility">致远</a>&nbsp;驱动
        </div>
      </div>
    </div>
    
    
  

  </body>
</html>